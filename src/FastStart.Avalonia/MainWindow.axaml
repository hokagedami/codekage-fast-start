<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:FastStart.Avalonia.ViewModels"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="700"
        x:Class="FastStart.Avalonia.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="FastStart"
        Width="600" Height="700"
        WindowStartupLocation="Manual"
        SystemDecorations="None"
        TransparencyLevelHint="AcrylicBlur"
        Background="Transparent"
        CanResize="False"
        ShowInTaskbar="False">

    <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
            CornerRadius="8"
            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
            BorderThickness="1">
        <Grid RowDefinitions="Auto,Auto,*">

            <!-- Search Box -->
            <Grid Grid.Row="0" Margin="16,12,16,8" ColumnDefinitions="*,Auto">
                <TextBox x:Name="SearchBox"
                         Watermark="Search for apps, settings, and documents"
                         Text="{Binding SearchQuery, Mode=TwoWay}"
                         Padding="36,8,12,8"
                         CornerRadius="4"
                         KeyDown="SearchBox_KeyDown"/>
                <PathIcon Grid.Column="0"
                          Data="M10.5 0a10.5 10.5 0 1 0 6.34 18.84l4.16 4.16a1 1 0 0 0 1.41-1.41l-4.16-4.16A10.5 10.5 0 0 0 10.5 0zm0 2a8.5 8.5 0 1 1 0 17 8.5 8.5 0 0 1 0-17z"
                          Width="16" Height="16"
                          HorizontalAlignment="Left"
                          Margin="12,0,0,0"
                          Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                <Button Grid.Column="1"
                        x:Name="SettingsButton"
                        Click="SettingsButton_Click"
                        Background="Transparent"
                        Margin="8,0,0,0"
                        Padding="8"
                        ToolTip.Tip="Settings">
                    <PathIcon Data="M12 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0zM8 2a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0V3a1 1 0 0 1 1-1zm0 12a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zM2 8a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2H3a1 1 0 0 1-1-1zm12 0a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1z"
                              Width="16" Height="16"/>
                </Button>
            </Grid>

            <!-- Search Results -->
            <ListBox Grid.Row="2"
                     IsVisible="{Binding ShowSearchResults}"
                     ItemsSource="{Binding SearchResults}"
                     SelectedItem="{Binding SelectedResult}"
                     Margin="8,0,8,8"
                     DoubleTapped="SearchResult_DoubleTapped">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="vm:AppViewModel">
                        <Grid ColumnDefinitions="32,*" Margin="8">
                            <Image Source="{Binding Icon}" Width="32" Height="32"/>
                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="12,0,0,0">
                                <TextBlock Text="{Binding App.Name}" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding App.ExecutablePath}"
                                           FontSize="11"
                                           Opacity="0.6"
                                           TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <!-- Default View: Pinned + Recent -->
            <ScrollViewer Grid.Row="2"
                          IsVisible="{Binding ShowDefaultView}"
                          VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="16,8,16,16">

                    <!-- Pinned Section -->
                    <Grid Margin="0,0,0,16" ColumnDefinitions="*,Auto">
                        <TextBlock Text="Pinned" FontSize="18" FontWeight="SemiBold"/>
                        <Button Grid.Column="1"
                                Content="All apps"
                                Click="AllApps_Click"
                                Background="Transparent"
                                Padding="8,4"/>
                    </Grid>

                    <ItemsControl ItemsSource="{Binding PinnedApps}" Margin="0,0,0,24">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:AppViewModel">
                                <Button Background="Transparent"
                                        Padding="4"
                                        Margin="4"
                                        Width="88"
                                        Click="PinnedApp_Click">
                                    <StackPanel HorizontalAlignment="Center">
                                        <Image Source="{Binding Icon}" Width="40" Height="40" Margin="0,0,0,4"/>
                                        <TextBlock Text="{Binding App.Name}"
                                                   HorizontalAlignment="Center"
                                                   TextAlignment="Center"
                                                   TextTrimming="CharacterEllipsis"
                                                   MaxLines="2"
                                                   TextWrapping="Wrap"
                                                   FontSize="12"/>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- Recent Section -->
                    <TextBlock Text="Recent" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,8"/>

                    <ItemsControl ItemsSource="{Binding RecentApps}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:AppViewModel">
                                <Button Background="Transparent"
                                        Padding="8"
                                        Margin="4"
                                        Width="250"
                                        HorizontalContentAlignment="Left"
                                        Click="RecentApp_Click">
                                    <Grid ColumnDefinitions="40,*">
                                        <Image Source="{Binding Icon}" Width="40" Height="40"/>
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding App.Name}"
                                                   VerticalAlignment="Center"
                                                   Margin="12,0,0,0"
                                                   TextTrimming="CharacterEllipsis"/>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- All Apps Section -->
                    <StackPanel x:Name="AllAppsSection" IsVisible="False">
                        <Grid Margin="0,16,0,8" ColumnDefinitions="Auto,*">
                            <Button Content="Back"
                                    Click="BackToPinned_Click"
                                    Background="Transparent"
                                    Padding="8,4"/>
                            <TextBlock Grid.Column="1"
                                       Text="All apps"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Center"/>
                        </Grid>

                        <ProgressBar IsIndeterminate="True"
                                     IsVisible="{Binding IsLoading}"
                                     HorizontalAlignment="Stretch"/>

                        <ListBox ItemsSource="{Binding AllApps}"
                                 DoubleTapped="AllApp_DoubleTapped">
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="vm:AppViewModel">
                                    <Grid ColumnDefinitions="32,*" Margin="4">
                                        <Image Source="{Binding Icon}" Width="32" Height="32"/>
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding App.Name}"
                                                   VerticalAlignment="Center"
                                                   Margin="12,0,0,0"
                                                   TextTrimming="CharacterEllipsis"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Border>
</Window>
